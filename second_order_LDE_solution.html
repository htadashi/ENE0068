<!DOCTYPE html>
<html lang="pt">
<head>
    <meta charset="UTF-8">
    <title>Equação Linear por Diferenças - Demonstração Interativa</title>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
        }
        .slider-container {
            margin-bottom: 10px;
        }
        .controls-container {
            display: flex;
            align-items: flex-start;
            gap: 40px;
        }
        .plots-container {
            display: flex;
            justify-content: center;
            align-items: flex-start;
            gap: 30px;
            margin-top: 20px;
        }
        .plot {
            height: 500px;
        }
        #unitCirclePlot {
            width: 700px;
        }
        #solutionPlot {
            width: 900px;
        }
        #equationDisplay {
            font-size: 1.3em;
            margin-top: 20px;
            text-align: center;
        }
    </style>
</head>
<body>

<h2>Solução de uma equação linear de diferenças de segunda ordem</h2>

<div class="controls-container">
    <div>
        <div class="slider-container">
            <label for="a1">a₁: </label>
            <input type="range" id="a1" min="-2" max="2" step="0.1" value="-1.2">
            <span id="a1-value">-1.2</span>
        </div>

        <div class="slider-container">
            <label for="a0">a₀: </label>
            <input type="range" id="a0" min="-1" max="1" step="0.05" value="0.32">
            <span id="a0-value">0.32</span>
        </div>
    </div>

    <div>
        <div class="slider-container">
            <label for="y_minus2">y[-2]: </label>
            <input type="range" id="y_minus2" min="-5" max="5" step="0.1" value="0">
            <span id="y_minus2-value">0</span>
        </div>

        <div class="slider-container">
            <label for="y_minus1">y[-1]: </label>
            <input type="range" id="y_minus1" min="-5" max="5" step="0.1" value="1">
            <span id="y_minus1-value">1</span>
        </div>
    </div>
</div>

<div class="plots-container">
    <div id="unitCirclePlot" class="plot"></div>
    <div id="solutionPlot" class="plot"></div>
</div>

<div id="equationDisplay"></div>

<script>
function updatePlots() {
    const a1 = parseFloat(document.getElementById('a1').value);
    const a0 = parseFloat(document.getElementById('a0').value);
    const y_minus2 = parseFloat(document.getElementById('y_minus2').value);
    const y_minus1 = parseFloat(document.getElementById('y_minus1').value);

    document.getElementById('a1-value').innerText = a1;
    document.getElementById('a0-value').innerText = a0;
    document.getElementById('y_minus2-value').innerText = y_minus2;
    document.getElementById('y_minus1-value').innerText = y_minus1;

    // Exibir a equação atual
    let eq = 'y[n] ';
    eq += (a1 >= 0) ? `+ ${a1} y[n-1] ` : `- ${Math.abs(a1)} y[n-1] `;
    eq += (a0 >= 0) ? `+ ${a0} y[n-2] = 0` : `- ${Math.abs(a0)} y[n-2] = 0`;
    document.getElementById('equationDisplay').innerHTML = eq;

    // Equação característica: z² + a1*z + a0 = 0
    const discriminant = a1 * a1 - 4 * a0;
    let roots = [];

    if (discriminant >= 0) {
        const r1 = (-a1 + Math.sqrt(discriminant)) / 2;
        const r2 = (-a1 - Math.sqrt(discriminant)) / 2;
        roots = [{re: r1, im: 0}, {re: r2, im: 0}];
    } else {
        const real = -a1 / 2;
        const imag = Math.sqrt(-discriminant) / 2;
        roots = [{re: real, im: imag}, {re: real, im: -imag}];
    }

    // Plot do círculo unitário
    const theta = Array.from({length: 361}, (_, i) => i * Math.PI / 180);
    const unitX = theta.map(t => Math.cos(t));
    const unitY = theta.map(t => Math.sin(t));

    const unitCircle = {
        x: unitX,
        y: unitY,
        mode: 'lines',
        name: 'Círculo Unitário',
        line: { dash: 'dot', width: 2, color: 'blue' }
    };

    const rootsTrace = {
        x: roots.map(r => r.re),
        y: roots.map(r => r.im),
        mode: 'markers',
        name: 'Raízes',
        marker: { size: 12, color: 'red' }
    };

    const layoutUnit = {
        title: 'Círculo Unitário e Raízes',
        width: 700,
        height: 500,
        xaxis: { title: 'Parte Real', range: [-2, 2] },
        yaxis: { scaleanchor: 'x', title: 'Parte Imaginária', range: [-2, 2] },
        showlegend: true
    };

    Plotly.newPlot('unitCirclePlot', [unitCircle, rootsTrace], layoutUnit, {responsive: true});

    // Resolver a equação por diferenças
    const N = 20;
    const y = Array(N + 3).fill(0);
    y[0] = y_minus2;  // y[-2]
    y[1] = y_minus1;  // y[-1]

    for (let n = 2; n < N + 3; n++) {
        y[n] = -a1 * y[n - 1] - a0 * y[n - 2];
    }

    const n_values = Array.from({length: N + 3}, (_, i) => i - 2);

    const solutionTrace = {
        x: n_values,
        y: y,
        mode: 'markers+lines',
        name: 'y[n]',
        marker: { color: 'red', size: 8 },
        line: { shape: 'hv' }
    };

    const layoutSolution = {
        title: 'Solução y[n]',
        width: 900,
        height: 500,
        xaxis: { 
            title: 'n',
            dtick: 1
        },
        yaxis: { title: 'y[n]' },
        showlegend: false
    };

    Plotly.newPlot('solutionPlot', [solutionTrace], layoutSolution, {responsive: true});
}

// Plot inicial
updatePlots();

// Listeners para sliders
['a1', 'a0', 'y_minus2', 'y_minus1'].forEach(id => {
    document.getElementById(id).addEventListener('input', updatePlots);
});
</script>

</body>
</html>
